# Lab: URL-based Access Control Can Be Circumvented

**Objective:** Access the blocked `/admin` panel and delete the user `carlos`.
**Vulnerability:** HTTP Header Spoofing via `X-Original-URL`.
**Constraint:** A frontend system blocks external requests to `/admin`, but the backend supports overriding the URL via headers.

---

## 1. Reconnaissance

I attempted to navigate directly to the `/admin` endpoint. The application (likely a frontend proxy or load balancer) immediately blocked the request, returning an "Access Denied" message.

![[Pasted image 20251124175524.png]]

---

## 2. Vulnerability Analysis

The lab description hints that the backend supports the `X-Original-URL` header. This header is often used by web frameworks (like Symfony) to allow a proxy to tell the backend what the *actual* requested URL was.

**The Logic Flaw:**
1.  **Frontend Check:** The frontend sees `GET /` (which is allowed) and lets the request pass.
2.  **Backend Processing:** The backend receives the request, sees the `X-Original-URL: /admin` header, and serves the content for `/admin` instead of `/`.

### Testing the Bypass
I intercepted a request to the home page (`/`) and added the header:

```http
GET / HTTP/1.1
Host: ...
X-Original-URL: /admin
```

The server accepted the request and returned the contents of the Admin Panel.

![[Pasted image 20251124175821.png]]

## 3. Exploitation

To solve the lab, I needed to trigger the "Delete User" functionality found in the admin panel. The delete link usually points to `/admin/delete?username=carlos`.

I constructed the final attack request by splitting the data:

1. **Real Path:** `/?username=carlos` (To pass the frontend and carry the parameter).
    
2. **Spoofed Path:** `/admin/delete` (To tell the backend which endpoint to execute).
    

**Payload:**

```http
GET /?username=carlos HTTP/1.1
Host: ...
X-Original-URL: /admin/delete
```
![[Pasted image 20251124180149.png]]

### Result

The backend executed the delete logic for the user specified in the query string. Carlos was successfully deleted.

![[Pasted image 20251124180246.png]]