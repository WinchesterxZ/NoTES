# Lab: Referer-based Access Control

**Objective:** Promote the user `wiener` to an administrator by bypassing access controls.
**Vulnerability:** Broken Access Control / Insecure Trust in HTTP Headers (Referer).
**Credentials:** `administrator:admin` (Recon), `wiener:peter` (Exploit).

---

## 1. Reconnaissance

I logged in as the `administrator` to capture a legitimate request for upgrading a user's role. I intercepted the traffic in Burp Suite to analyze the headers required by the backend.

**Analysis of the Request:**
I noticed the request included a `Referer` header pointing to the admin panel URL.

```http
Referer: https://0a5d00d103f8a57688d2af2400f2005b.web-security-academy.net/admin
```

![[Pasted image 20251124182239.png]]

## 2. Vulnerability Analysis

I switched to the low-privileged account (`wiener`) and attempted to perform the same "Upgrade User" action using my session cookies.

The server responded with "Unauthorized" because my request originated from a standard user page, or lacked the specific administrative context the server expected.

![[Pasted image 20251124183036.png]]

**The Logic Flaw:** The application validates privileges based on the **Referer** header. It assumes that if a request _claims_ to come from the `/admin` page, the user must have had access to that page.

Since the `Referer` header is sent by the client (browser), it is entirely user-controllable and untrustworthy for security checks.

## 3. Exploitation

I sent the blocked request to Burp Repeater. I manually added (or modified) the `Referer` header to spoof the origin of the request, making it look like it came from the Admin Panel.

**Payload:**

```http
GET /admin-roles?username=wiener&action=upgrade HTTP/1.1
Host: ...
Referer: https://0a5d00d103f8a57688d2af2400f2005b.web-security-academy.net/admin
```

![[Pasted image 20251124183138.png]]

### Result

The server accepted the spoofed header as proof of authorization and processed the upgrade request.

![[Pasted image 20251124183203.png]]
