# Root Me: File Upload - Null Byte

**Objective:** Upload a PHP shell to the photo gallery by bypassing extension filters.
**Vulnerability:** Null Byte Injection (`%00`) / Poison Null Byte.
**Constraints:** The server validates both the file extension and the MIME type.

---

## 1. Reconnaissance & Filtering Analysis

I started by probing the upload filter to understand exactly what the server checks.

1.  **Attempt 1 (Pure PHP):** Uploading `shell.php` failed. The server likely checks for a specific allow-list of extensions (e.g., `.jpg`, `.png`).
    ![[Pasted image 20251127041934.png]]

2.  **Attempt 2 (Extension spoofing):** I renamed the file to `shell.jpg` (containing PHP code) but kept the Content-Type as `application/x-php`. This also failed.
    ![[Pasted image 20251127042125.png]]

3.  **Attempt 3 (MIME spoofing):** I kept the name `shell.jpg` AND changed the Content-Type to `image/jpeg`. The upload succeeded.
    ![[Pasted image 20251127042213.png]]

**Conclusion:** The server enforces **two** checks:
1.  The filename must end with a valid image extension (e.g., `.jpg`).
2.  The `Content-Type` header must match an image type.

---

## 2. Vulnerability: Null Byte Injection

Since I need the file to end in `.jpg` to pass the check, but I need the OS to save it as `.php` to execute it, I can use the **Null Byte (`%00`)**.



**The Logic Flaw:**
High-level languages (like PHP/Java) manage strings with length properties, so they see the whole string: `shell.php%00.jpg`.
However, low-level system functions (written in C) use a **Null Terminator** to mark the end of a string. When the file is saved to the disk, the C functions stop reading at `%00`, effectively ignoring everything after it.

* **Validator sees:** `shell.php\0.jpg` (Ends in .jpg? YES -> PASS)
* **Filesystem sees:** `shell.php` (Stops at \0 -> Saves as PHP)

---

## 3. Exploitation

I prepared the malicious payload in Burp Proxy.

### Payload Configuration
* **Filename:** `shell.php%00.jpg` (The `%00` represents the null byte character).
* **Content-Type:** `image/jpeg` (To satisfy the MIME check).

![[Pasted image 20251127042333.png]]

### Execution
The server accepted the file. When I navigated to the upload directory, I searched for the filename *without* the junk extension (`shell.php`).

```http
(http://challenge01.root-me.org/.../shell.php?cmd=cat) .passwd
```

![[Pasted image 20251127042436.png]]

The file executed as PHP, allowing me to retrieve the validation password.

![[Pasted image 20251127042515.png]]