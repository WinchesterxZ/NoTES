# Root Me: File Upload - MIME Type

**Objective:** Upload a PHP shell to the photo gallery and retrieve the validation password from the `.passwd` file.
**Vulnerability:** File Upload Restriction Bypass (Insecure MIME Type Validation).
**Target File:** `.passwd`

---

## 1. Reconnaissance

I attempted to upload a standard PHP web shell (`shell.php`). The server immediately rejected the file with an error message indicating invalid file content.

![[Pasted image 20251127040949.png]]

**Analysis:**
Since the filename `shell.php` itself wasn't explicitly blocked, but the upload failed, the server is likely checking the **MIME Type** (Multipurpose Internet Mail Extensions) of the file to ensure it is an image.

---

## 2. Vulnerability Analysis

Web servers often rely on the `Content-Type` HTTP header sent by the browser to determine what kind of file is being uploaded.



**The Logic Flaw:**
The `Content-Type` header is completely user-controlled. If the server only checks this header and does not analyze the actual *content* of the file (e.g., magic bytes), we can lie to the server about what we are sending.

---

## 3. Exploitation

I used Burp Suite to intercept the upload request for `shell.php`.

### Payload Modification
In the intercepted request, I located the `Content-Type` header, which defaulted to `application/x-php`. I manually changed it to a valid image MIME type.

**Original Header:**
```http
Content-Type: application/x-php
```

**Modified Header:**
```
Content-Type: image/jpeg
```
![[Pasted image 20251127041157.png]]

### Result

The server trusted the header, accepted the "image," and saved the executable PHP file to the server.
## 4. Flag Retrieval

I accessed the uploaded file directly via the browser and appended the command execution parameter.

**Payload:**

```bash
cat ../../../.passwd
```
![[Pasted image 20251127041252.png]]

The server executed the system command and returned the contents of the `.passwd` file.

![[Pasted image 20251127041442.png]]

