# Lab 4: Username Enumeration via Account Lock

This lab is vulnerable to username enumeration via a subtle logic flaw in the account locking mechanism. To solve the lab, we need to enumerate a valid username by triggering the lock, brute-force that user's password, and then access their account page.

**Lab Details:**
- [Candidate usernames](https://portswigger.net/web-security/authentication/auth-lab-usernames)
- [Candidate passwords](https://portswigger.net/web-security/authentication/auth-lab-passwords)

---

## 1. Investigation & Login Analysis

### Observations
Upon attempting to log in initially, there were no immediate indicators since we did not know a valid username.
![[Pasted image 20251120162409.png]]

- **Hypothesis:** The lab description mentions account locking. If a **Blocking Mechanism** exists (e.g., after **3 to 5 incorrect attempts**), the server might respond differently for a valid username compared to an invalid one. We need to test this theory to identify the valid user.

### Logic Flaw Discovery
To test for the account lock, we can use **Burp Intruder** with a **Cluster Bomb** attack type.
- **Payload 1:** The list of candidate usernames.
- **Payload 2:** A small list of arbitrary passwords (or a null payload repeated 5 times) to force multiple login attempts per username.

![[Pasted image 20251120161841.png]]

---

## 2. Exploitation Strategy: Enumeration

The goal is to have Intruder take each username and make ~5 wrong attempts. We will monitor the results to see if any username returns a "Locked" message, which would confirm its validity.

I used a **Grep - Negative Match** (or simply sorted by length) to filter out the standard `Invalid username or password.` response.

![[Pasted image 20251120162609.png]]

**Attack Logic:**
1.  Attempt `an` + Wrong Pass (Result: Invalid)
2.  Attempt `an` + Wrong Pass (Result: Invalid)
3.  Attempt `an` + Wrong Pass (Result: Account Locked)

**Result:**
The username `an` eventually triggered a different response length or error message indicating the account was locked. We have now identified the valid user.

---

## 3. Executing the Attack: Password Brute-force

Now that we have the username `an`, we can perform a standard brute-force attack to find the password.

### Burp Intruder Configuration
1.  Send the login request to **Intruder**.
2.  Set the attack type to **Sniper**.
3.  Set the username to `an` and set payload markers for the `password` field.

![[Pasted image 20251120163041.png]]

### Results & The Logic Flaw
Start the attack. Even though the account is technically "locked," this lab contains a logic flaw regarding the error messages.

**The Flaw:** If you attempt to log in with the **correct password** while the account is locked, the application fails to return the "Invalid username" or "Account locked" error message.

![[Pasted image 20251120163319.png]]

I noticed that while most requests returned an error, **one response did not contain any error message at all**. This anomaly indicates that the password attempted in that request is the correct one.

![[Pasted image 20251120163419.png]]