# Lab: Broken Brute-force Protection, Multiple Credentials Per Request

**Objective:** Solve the lab by brute-forcing Carlos's password and accessing his account page.
**Victim:** `carlos`
**Wordlist:** [Candidate passwords](https://portswigger.net/web-security/authentication/auth-lab-passwords)

---

## 1. Reconnaissance & Analysis

Upon attempting to log in, I observed that the application enforces a strict lockout policy. After **4 failed attempts**, the account is blocked.

![[Pasted image 20251122221619.png]]

### Attempted Bypasses
I attempted several standard bypass techniques which proved ineffective:
- Changing the `User-Agent` header.
- Spoofing the IP address via `X-Forwarded-For`.
- Attempting to pivot via a second account (not possible as valid credentials were not provided).

### Request Structure
Analyzing the intercepted login request in Burp Suite revealed that the application accepts data in **JSON format**.

![[Pasted image 20251122221752.png]]

---

## 2. Vulnerability Discovery

Since the application parses JSON, I hypothesized that the backend might accept an **array of passwords** instead of a single string.

**The Logic Flaw:**
If the backend validates the list of passwords in a loop but only increments the brute-force counter *per HTTP request* (rather than per password attempt), we can bypass the lockout mechanism by sending all candidate passwords in a single request.

I tested this hypothesis by sending a small array: `["test1", "test2"]`.

![[Pasted image 20251122221924.png]]

The server accepted the array structure without error, confirming the potential vector.

---

## 3. Exploitation

To execute the attack, I needed to format the provided list of candidate passwords into a JSON string array.

### Payload Generation
I wrote a simple Python script to convert the raw password list into a format suitable for the JSON array (quoted strings separated by commas).

```python

with open('passwords.txt', 'r') as f:
    lines = [f'"{line.strip()}"' for line in f if line.strip()]
print(',\n'.join(lines))
```

### Execution

1. Ran the script and copied the output.
2. Intercepted the login request.
3. Replaced the single password string with the full array of candidate passwords inside the JSON body.

![[Pasted image 20251122222430.png]]

### Result

The server processed the request, iterated through the array, and successfully matched the correct password against the hash. The response confirmed the login was successful.

![[Pasted image 20251122222749.png]]

We are now logged in as Carlos.

![[Pasted image 20251122222817.png]]