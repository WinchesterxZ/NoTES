# Local File Inclusion (LFI) to Remote Code Execution (RCE)

---

## Verified Exploitation Vectors

### 1. PHP Stream Wrappers

#### A. `php://input` Stream Inclusion
This technique uses the read-only `php://input` stream to read raw data directly from the request body as executable PHP code.

* **Mechanism:** The LFI parameter is set to `php://input` in a `POST` request, and the PHP payload (e.g., `<?php phpinfo();?>`) is placed in the request body.
* **Limitation:** This is unavailable in `POST` requests using `enctype="multipart/form-data"` if the `enable_post_data_reading` option is enabled.

#### B. `expect://` Wrapper (Rare)
The `expect://` wrapper provides access to a process's standard input, output, and error streams via PTY (Pseudo-Terminal).

* **Usage:** A command can be executed directly, such as `expect://command`.
* **Note:** This wrapper is **not enabled by default**. It requires the separate `Expect` extension available from PECL to be installed.

---

### 2. File System Injection

#### A. Log File Injection (Log Poisoning)
Log files (web access/error, FTP, SSH, Mail) often record user-controllable input, such as the `User-Agent` header. Injecting PHP code into these headers effectively "poisons" the log.

* **Mechanism:** Including the log file via the LFI vulnerability causes the web server to execute the injected PHP code when parsing the log content.
* **Common Targets:** `/var/log/apache/access.log`, `/var/log/apache/error.log`, `/var/log/vsftpd.log`, `/var/log/sshd.log`, and `/var/log/mail`.

#### B. Leveraging File Upload Functionality
If the application has a file upload feature (e.g., for avatars), an attacker can upload a malicious file containing PHP code, often disguised with a benign extension (like `.jpg`).

* **Mechanism:** The LFI is used to include the file from its predictable upload path, executing the code.

#### C. PHP Session Data Injection
PHP stores session data in files (e.g., `/var/lib/php5/sess_[PHPSESSID]`). If an attacker can control part of the session data (e.g., via headers or parameters), they can inject executable code into the session file.

* **Mechanism:** Including the specific session file via LFI triggers the execution of the injected code during session processing.

---

### 3. Linux Pseudo-Filesystem Access

#### A. `/proc/self/environ` Inclusion (Deprecated)
This pseudo-file contains environment variables like `HTTP_USER_AGENT`. Code is injected via a header, and the file is included.

* **Note:** This is considered an old technique. On updated Linux systems, this file is generally not accessible to non-root users, meaning the technique **will not work**.

#### B. `/proc/self/fd/1` File Descriptor Access
File descriptors under `/proc/self/fd/` provide symbolic shortcuts to currently open file handles.

* **Mechanism:** Including a descriptor like `/proc/self/fd/1` (stdout) can sometimes provide access to logs or streams containing injected PHP code.
