# Linux Privilege Escalation THM
This room covers various methods to escalate privileges on Linux machines, based on the course by Heath Adams (TCM).

---

## Task 3: Privilege Escalation — Kernel Exploits

Kernel exploits rely on vulnerabilities in the Linux kernel code to execute arbitrary code with elevated permissions.

**Exploitation Steps:**
1.  Identify the kernel version (`uname -a`).
2.  Search for matching exploits (e.g., Dirty COW).
3.  Compile and run the exploit.

Once we run the exploit and run `passwd`, we will have become root.
![[1_O9WPUFqIvJUWbdLHzRh1LQ.webp]]
----
## Task 4: Privilege Escalation — Stored Passwords (Config Files)

Developers sometimes leave credentials in plain text within configuration files.

**Investigation:**
We found a configuration file associated with OpenVPN.
![[1_dsNMq7XZKORXCHAHN9W26Q.webp]]
![[1_PVDJue2PxTFfn557BQQWxw.webp]]
**Questions:**
* **What password did you find?**
    * `password321`
* **What user’s credentials were exposed in the OpenVPN auth file?**
    * `user`

---

## Task 5: Privilege Escalation — Stored Passwords (History)

If a user accidentally types their password into the terminal instead of a prompt, or passes credentials as arguments, they get stored in the history file (e.g., `.bash_history`).

![[1_zx5AS5FVanuMYC3Ta4KgJg.webp]]
**Questions:**
* **What was TCM trying to log into?**
    * `mysql`
* **Who was TCM trying to log in as?**
    * `root`
* **Naughty naughty. What was the password discovered?**
    * `password123`

---

## Task 6: Privilege Escalation — Weak File Permissions

If sensitive files like `/etc/shadow` are world-readable or world-writable, unprivileged users can crack hashes or modify passwords directly

![[1_bjI3s960baWzRJPOGN7yww.webp]]
![[1_Nz2w4DxBJM3Yy67zVBW72w.webp]]
![[1_0DqxaUStGBefvUf5a7UZ6g 1.webp]]
![[1_i68M74RLyRiG0lJKeoXB0A.webp]]

**Questions:**
* **What were the file permissions on the /etc/shadow file?**
    * `-rw-rw-r--` (World Readable)

---

## Task 7: Privilege Escalation — SSH Keys

If a user's private SSH key (`id_rsa`) is left readable in a directory (like a backup folder), it can be used to authenticate as that user.

![[1__2zuFqxMIDLJo1TN6iPmNA.webp]]
![[1_4Vh_dk3C4rcaQFe0ndMvJA.webp]]
![[1_Omkh_Em7PBzJhWJTNOQxcQ.webp]]
**Questions:**
* **What’s the full file path of the sensitive file you discovered?**
    * `/backups/supersecretkeys/id_rsa`

---

## Task 8: Privilege Escalation — Sudo (Shell Escaping)

If a user is allowed to run a command as root via `sudo`, and that command allows escaping to a shell (e.g., `vim`, `less`, `awk`), they can spawn a root shell.

![[1_7JSQ2yKsga1IBrQLfcz9kA.webp]]
![[1_GLXWavgZD3EBGSVw97bkFA.webp]]

**Reference:**
Check [GTFOBins](https://gtfobins.github.io/) for binaries that allow shell escapes.

---

## Task 9: Privilege Escalation — Sudo (Abusing Intended Functionality)

Sometimes a program doesn't spawn a shell, but its intended functionality allows reading or writing sensitive files (e.g., using `apache2` to read `/etc/shadow`).

![[1_vtU0b0_3fkKut4b4nYf1qg.webp]]
![[1_8NQoNvfdSjh61k95NVqi6g.webp]]
![[1_XYjcAElyLl9Sl6mAgYaobA.webp]]
![[1_n8Blt5-NkMNu3tqrs8ch7w.webp]]

---

## Task 10: Privilege Escalation — Sudo (LD_PRELOAD)

If `sudo -l` shows that the `LD_PRELOAD` environment variable is preserved, you can load a malicious shared object file before the program runs, executing your code as root.

![[1_Wrjed1qmiboyJQY3H9kkgA.webp]]
![[1_ztujY5AJbNoMFxuTd0vuow.webp]]
![[1_IVEkDmdyCLkA4vfw2DUPGw.webp]]

---
## Task 11: Privilege Escalation — SUID (Shared Object Injection)

SUID (Set User ID) binaries run with the permissions of the file owner (usually root). If an SUID binary tries to load a shared object (.so) that doesn't exist or has a weak search path, you can create a malicious .so file in that location.

![[1_VgBO6ljFXRqPfm_9vCAIAg.webp]]
![[1_3EfBhHP2SpObYBgebx_yew.webp]]

![[1_WkmwghPPAktY7XdzUb9XMg 1.webp]]
![[1_STuBQ9Fwo6erGDNnMoA7aA.webp]]

---
## Task 12: Privilege Escalation — SUID (Symlinks)

This task exploits a vulnerability (Nginx code execution) where an SUID binary can be tricked into writing to a root-owned file via a symbolic link.

![[1_pfvJ5YzT053hDOaUwNStqQ.webp]]
![[1_cGOk2n3A97CR9A9qqJ6uZQ.webp]]
![[1_n56JcausVl2RVA2rWb7pUg.webp]]
**Questions:**
* **What CVE is being exploited in this task?**
    * `CVE-2016-1247`
* **What binary is SUID enabled and assists in the attack?**
    * `sudo`

---

## Task 13: Privilege Escalation — SUID (Environment Variables #1)

If an SUID binary runs another command via a relative path (e.g., `service` instead of `/usr/sbin/service`), you can hijack the `PATH` variable to run your own malicious version of `service`.

![[1_I_Tdh1uBwjVWNIS-NrUqEA 1.webp]]
![[1_ddHpQgVIArRzulhhyqokbg.webp]]
![[1_YE2BlMj0OdiJJPcBzvk_UQ.webp]]
**Questions:**
* **What is the last line of the “strings /usr/local/bin/suid-env” output?**
    * `service apache2 start`

---

## Task 14: Privilege Escalation — SUID (Environment Variables #2)

Even with absolute paths, if the environment is not sanitized, other functions defined in Bash might be usable for escalation (Bash < 4.2).
![[1_typxydik6T7_Tfc2OjpO3Q.webp]]
![[1_6swYYmx-DO9CcZP_XCDqlg.webp]]
**Questions:**
* **What is the last line of the “strings /usr/local/bin/suid-env2” output?**
    * `/usr/sbin/service apache2 start`

---

## Task 15: Privilege Escalation — Capabilities

Linux Capabilities allow granular privileges (like reading arbitrary files) to be assigned to binaries without giving them full SUID root status. However, capabilities like `cap_setuid+ep` can still be abused to become root.

![[1_NHQLOIe3xpPHmt2bA762Kw.webp]]
![[1_GXQjXKatTQWlNMuVP1IxPg.webp]]

---

## Task 16: Privilege Escalation — Cron (Path)

If the Cron daemon's `PATH` variable includes a directory that is writable by your user, you can create a script with the same name as a cron job in that directory to hijack execution.

![[1_bu7bTVzHhNkCtPD-4QvFZw.webp]]
![[1_CEo7hDZHxWcL2gwTZZfARQ.webp]]

---

## Task 17: Privilege Escalation — Cron (Wildcards)

If a cron job runs a command with a wildcard (e.g., `tar *`), you can create files with names that look like command flags (e.g., `--checkpoint-action=exec=sh shell.sh`) to trick the binary into executing code.

![[1_EqeoA12EZ1RoK8XxqnU79w.webp]]![[1_44vpsFnozsn92DdjfC47Qg.webp]]
![[1_E8hK4tCtwEbA0q6KyO6ZAA.webp]]
![[1_v6n5ODnHaK47gvSQFUastA.webp]]

---

## Task 18: Privilege Escalation — Cron (File Overwrite)

If a script executed by Cron is writable by your user, you can simply overwrite the script with a reverse shell.
![[1_FS4p4CJ2DiRizOR7QIi8pw.webp]]
![[1_gQF_3DOINkMBtN7GUzvtlQ.webp]]
![[1_6LF0Be4UHYgCXsyuULw2_w.webp]]
![[1_bTU-QkTHnj1RfMgaU1FvWw.webp]]
