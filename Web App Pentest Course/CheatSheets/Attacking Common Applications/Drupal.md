**Drupal** هو نظام إدارة محتوى (CMS) قوي ومفتوح المصدر، يعتمد على PHP وقواعد بيانات (MySQL, PostgreSQL, أو SQLite). يتميز باستخدامه الكثيف في المواقع الحكومية والتعليمية والشركات الكبرى.

#### 1. الاستكشاف والبصمة (Discovery/Footprinting)

كيف تعرف أن الهدف يعمل بنظام Drupal؟ هناك عدة علامات مميزة:

- **الكود المصدري (Source Code):**
    
    - ابحث عن وسم `meta name="Generator"`، غالباً ما يحتوي على "Drupal 8" أو رابط للموقع الرسمي.
        
    - عبارة "Powered by Drupal" في الفوتر (Footer) أو الهيدر.
        
- **ملفات النظام القياسية:**
    
    - وجود ملفات مثل `CHANGELOG.txt` أو `README.txt` أو `LICENSE.txt`.
        
- **هيكل الروابط (URL Structure) - الـ Nodes:**
    
    - Drupal يقوم بفهرسة المحتوى (مقالات، صور، صفحات) على هيئة "عقد" أو **Nodes**.
        
    - الروابط غالباً تأخذ الشكل `/node/<id>` (مثال: `/node/1`). هذه علامة قوية جداً حتى لو تم تغيير شكل الموقع (Theme).
        
- **ملف `robots.txt`:**
    
    - قد يحتوي على مسارات محظورة مميزة لـ Drupal مثل `/node/`.
        

#### 2. أنواع المستخدمين (User Roles)

النظام يدعم افتراضياً ثلاثة أنواع:

1. **Administrator:** تحكم كامل في الموقع.
    
2. **Authenticated User:** مستخدم مسجل، يمكنه الدخول والتعديل حسب صلاحياته.
    
3. **Anonymous:** الزائر العادي، غالباً له صلاحية القراءة فقط.
    

#### 3. الحصر واستخراج الإصدار (Enumeration)

بعد التأكد أن الموقع Drupal، نحتاج لمعرفة الإصدار والإضافات.

- **الطريقة اليدوية (CHANGELOG.txt):**
    
    - في الإصدارات القديمة، كان ملف `CHANGELOG.txt` متاحاً للعامة ويحتوي على سجل التحديثات، مما يكشف الإصدار بدقة.
        
    - في الإصدارات الحديثة (مثل Drupal 8 وما بعده)، غالباً ما يتم حجب هذا الملف ويعطيك `404 Not Found`.
        
- **الطريقة الآلية (Droopescan):**
    
    - كما استخدمناها مع Joomla، أداة `droopescan` فعالة جداً مع Drupal (أفضل حتى من أدائها مع Joomla).
        
    - تقوم بفحص: الإصدار المحتمل، الإضافات (Plugins/Modules)، القوالب (Themes)، والروابط المهمة (مثل صفحة الدخول `/user/login`).


# Drupal Pentesting Cheat Sheet


##  Automated Enumeration (Droopescan)

**Droopescan** is highly effective for Drupal. It identifies plugins, themes, and versions.

**Command:**
Scans for plugins, themes, version, and interesting URLs.
```bash
droopescan scan drupal -u [http://drupal.inlanefreight.local](http://drupal.inlanefreight.local)
```

### Sample Output Analysis
* **Plugins found:** Lists installed modules (e.g., `/modules/php/`).
* **Possible version(s):** Gives a list of likely versions (e.g., `8.9.1`).
* **Interesting URLs:** Finds admin/login paths (e.g., `/user/login`).

## 3. Key Files & Paths
| Path | Description |
|------|-------------|
| `/CHANGELOG.txt` | Detailed version history (Goldmine if accessible). |
| `/README.txt` | General info, sometimes version. |
| `/node/` | Content structure. |
| `/user/login` | Default login page. |
| `/robots.txt` | Often reveals Drupal paths. |

# RCE
### الخطوات (Execution Steps)

1. **تفعيل الموديول (Enable Module):**
    
    - من الشريط العلوي اضغط على **Modules**.
        
    - ابحث في القائمة (تحت قسم Core) عن **PHP Filter**.
        
    - فعّل الـ Checkbox جنبه وانزل تحت خالص اضغط **Save configuration**.
        
2. **ضبط الصلاحيات (Check Permissions) - خطوة مهمة:**
    
    - أحياناً حتى لو فعلته، الأدمن مش بياخد صلاحية استخدامه أوتوماتيك.
        
    - روح لـ **People** > **Permissions**.
        
    - دور على **Filter** وتأكد إن الـ Administrator معمول له علامة صح قدام **Use the PHP code text format**.
        
    - اضغط **Save permissions**.
        
3. **الحقن (Inject Payload):**
    
    - روح لـ **Content** > **Add content** > **Basic page**.
        
    - في خانة **Body**، حط كود الـ Shell بتاعك (شوف الكود تحت).
        
    - **أهم نقطة:** تحت الصندوق ده هتلاقي قائمة منسدلة اسمها **Text format**، غيرها وخليها **PHP code**.
        
    - اضغط **Preview** (عشان الكود يتنفذ فوراً بدون ما تحفظ الصفحة وتفضح نفسك) أو **Save**.