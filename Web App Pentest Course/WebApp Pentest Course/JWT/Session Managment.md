# Session Management 

## 1. المفهوم الأساسي: بروتوكول HTTP

الـ **HTTP** بطبيعته هو بروتوكول **Stateless** (عديم الحالة).

> **بمعنى:** السيرفر يتعامل مع كل Request (طلب) بشكل منفصل تماماً عن الذي قبله. بمجرد أن يرسل السيرفر الـ Response، يقطع علاقته بك وينسى من أنت.

**المشكلة:** بدون نظام لإدارة الجلسات، لو قمت بتسجيل الدخول (Login) ثم حاولت الانتقال لصفحة أخرى (مثل تغيير الصورة الشخصية)، السيرفر سيطلب منك تسجيل الدخول مرة أخرى لأنه نسى أنك قمت بذلك في الطلب السابق.

---

## 2. الحل: مفهوم الـ Session

لحل مشكلة "النسيان" لدى السيرفر، تم ابتكار الـ Session Management لربط الطلبات ببعضها البعض وتمييز المستخدمين.

### آلية العمل (The Workflow)

تنقسم العملية إلى مرحلتين أساسيتين: مرحلة الإنشاء (Creation) ومرحلة الاستخدام اللاحق (Subsequent Requests).

#### أولاً: عند تسجيل الدخول (The Handshake)

1. ال **Client:** يرسل اليوزر والباسورد (Credentials).
2.  ال **Server:**
    - يتأكد من صحة البيانات.
        
    - يقوم بإنشاء **Session ID** (رقم معرف فريد وعشوائي).
        
    - يقوم بتخزين هذا المعرف في قاعدة بياناته (أو في الذاكرة) وربطه ببيانات المستخدم.
        
    - _مثال على التخزين في السيرفر:_

```
Session_ID: "abc123_secure_random"  --->  User: "Ahmed"
Session_ID: "xyz987_secure_random"  --->  User: "Mohamed"
```

3. ال **Server Response:** يرسل السيرفر الـ Session ID إلى المتصفح (Browser) داخل الـ HTTP Response Header المسمى `Set-Cookie`.
#### ثانياً: التخزين في المتصفح (Client-Side Storage)

- يستلم المتصفح الـ Response.
    
- يقوم بتخزين الـ Cookie داخل ما يسمى بالـ **Cookie Jar**.
    
- ال **Cookie Jar:** هو مخزن داخل المتصفح يحتفظ بالكوكيز لكل موقع على حدة (كوكيز فيسبوك منفصلة عن إنستجرام).
#### ثالثاً: الطلبات اللاحقة (Subsequent Requests)

1. عندما يحاول المستخدم القيام بأي إجراء (مثل فتح البروفايل).
    
2. يقوم المتصفح **تلقائياً** بالبحث في الـ Cookie Jar: "هل لدي كوكي لهذا الموقع؟".
    
3. إذا وجدها، يقوم بإرفاقها داخل الـ Request Header المسمى `Cookie`.
    
4. ال **Server Check:**
    
    - يستلم السيرفر الطلب ويقرأ الـ Cookie.
        
    - يبحث عن الـ Session ID الموجود فيها داخل سجلاته.
        
    - اذا وجد تطابقاً (Match): يعرف أن هذا الطلب قادم من "أحمد"، فيسمح له بتغيير الصورة.

### هيكل الـ HTTP Headers

**السيرفر يرسل للعميل:**

```http
HTTP/1.1 200 OK
Set-Cookie: session_id=abc123_secure; Path=/; HttpOnly
```

**العميل يرسل للسيرفر (في المرات القادمة):**

```http
GET /profile_picture HTTP/1.1
Host: example.com
Cookie: session_id=abc123_secure
```
