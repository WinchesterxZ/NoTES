

AD ->  write a simple definatio 
DOMAIN vs DC 
domain is logical that all devices comes ner it 
dc is the (physical) hardware it self that the AD Services Run on It.

windows servier is the special os that has the aAd services and we can run it on the DC 

 DOMAIN -> contains OU,Devices, Users , groups
 
 users -> people that has normal accounts on ad
 GROUPS -> GROUP OF UUSERS 
 ou -> GROUP OF MULTIPLE THINGS NOT JUUST UUSERS 
 
 aCCESS cONTROL LIST -> CONTROLS USERS PERMISSIONS , DEVICE SERVICES AND SO ON 
 
 BECAUSE IF THE LOADS ON THE DEVICE DC THEY MADE CONCEPT TRUST 
 
 TRUST-> SIMPLY YOU MAKE MORE THAN ONE DC AND ADD A REPLICATION PERMISSIONS BETWEEN THEM (ITS LKIE TAKING SNAPSHOT FROM ONE DC AND RNS IT ON ANOTHER DC)
 SO IF USER IS ASKING FOR SOME PERMISSION AND MAIN DC IS BUSY A REPLICATED DC CAN REPLY AND THIS WHAT IS CALED **LOAD BALANCING**
 
 
MICROSOFT DECIDED TO MAKE SUBDOMIANS FOR MORE TRUST 

 EX:              
 BNK.LOCAL -> EG.BANK.LOCAL
 BANK.LOCAL -> SA.BANK.LOCAL 
 PARENT TRUST CHILD AND CHILD TRUSTS PARENT 
 
 EACH DOMAIN HAS DOMAIN ADMINS GROUP 
 WHEN WE SPLIT THE DOMAIN INTO MULTI SUBDOMAINS THE DAG IS CREATED FOR EACH SUB DOMAIN 
 AND THE PAREN DAG IS PROMETED TO ENTERPRISE ADMIN AND HE CAN BE ADMIN IN ANY SUBDOMAIN 
 
 
 
 
 #          AUTH 
 
 - WINDOWS AUTH (NO DOMAIN LOCAL) -> 
 WHEN U ENTER UR PASSOWRD ON UR OWN PC    
 1- DEVICE TAKES PASSWORD AND CONVERT IT TO NTLM HASH (MD4 HASING) 
 2- IF USER EXISTS THEN THE DEVICE COMPARES THE HASH WITH THE SAM FILES (SAM FILE INCLDING ALL USERS AND THEIR HASHES) 
 3- IF COMPARES MATCHED U SUCCESS TO LOGIN IF IT FAILED IT ASKS U TO LOGIN AGAIN WRONG PASSWORD 
 
 
 - NETWORK AUTH NTLMv2 PROTCOL (NET)
 - USER DECIDED TO ACCESS SERVICE IN ANOTHER DEVICE OR ACCESS ANOTHER DEVICE 
 1- UR OWN PC CALCULATE NTLM OF R PASSORD 
 2- ASKING THE SEVICE TO BE AUTHNTICATED 
 3- SERVICE SEND NANCE TO USER AND TAKE A COPY OF IT (AND ASKS USER TO ENCRYPT THE NANCE USING NTLM HAS OF THE USER )
 4- UR DEVICE THEN SEND THE ENCRYPTED NANCE TO THE SERVICE 
 5- SERVICE SEENDS USERNAME OF THE USER + NANCE + ENCRYPTED NANCE TO DC
 6- DC THEN TKAES THE USER WAS SENT TO HIM AND ADD IT TO NTDS.DIT 
 7- SINCE THE DC HAS THE USER AND ITS NTLM HASH THE DC ENCRYPTS THE NANCE 
 8- THEN IT COMPARESS THE ENCRPTED NANCE WITH THE ONE IT ENCRYPTED BY ITSELF 
 
 (NOTE THAT THE NTDS.DIT IS LKIE THE SAM BT IN DOMAIN SO THATS WHY IT INCLUEDED THE USER AND ITS HASH )
 
 
 
 
 
 TGT TICKET GRANING TICKET  -> USER 
 TGS TICKEET GRANDING SERVICE -> SERVICE
 
 
- kERBEROS (NETWORK) 
1- USER LOGIN THEN CLACULATE NTLM HASH 
2- USER SENDS AUTH REQUEST  AS -REQ TO DC INT INCLUDES TIME STAMP + TIME STAMP ENCRYPTED BY NTLM HASH 
3- DC TAKES TIME STAMP AND SEARCH FOR THE USER IN THE NTDS.DIT THEN ENCRYPTS THE TIME STAMP WITH NTLM HASH OF USER THEN DO COMPRESSION 
- IF SUCCCESS DC RESPONSE WITH AC-RESPONSE -> TGT (ITS LIKE UR PRROF THAT U ARE AUTHENICATED)
- WHEN USER WANTS TO ACCESS SOME SERVICE USER ASKS FOR TGS SENDS (TGS REQ + TGT ) THEN DC LOOKUP YHE SERVICE IF ITS OK IT REPLIES WITH TGS 
4- PC TAKES TGS AND GO TO SERVER THAT HAS THIS SERVICE -> SERVCER MIGHT ACCEPT IT DIRECTLY OR GO TO CHECK WITH DC 
(PROBLEM WHEN DC REPLIS WITH TGT OT TGS)


NOTES 
ON CREATING AD -> USER CALLED KRBTGT IS CREATED BY DEFAULT IS RESPOSIBLEE FOR SIGNING THE TGT U ARE GETTTING
SO THIS USER IS 2ND CRITICAL COMES AFTER ADMIN 
- NOTE THAT THE TGS IS ENCRYPREED BY SERVICE IT SLEF 



